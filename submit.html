<!DOCTYPE html>
<html>
<head>
    <title>投稿新作</title>
    <link rel="stylesheet" href="styles.css"> 
    <script>
        async function saveToGitHub() {
            const title = document.getElementById("title").value; 
            const content = document.getElementById("content").value; 
            const category = document.getElementById("category").value; 
            
            // 获取GitHub Token 
            const token = localStorage.getItem('githubToken')  || 
                          prompt('请输入GitHub Token:');
            localStorage.setItem('githubToken',  token);
 
            // 发送数据到GitHub 
            const response = await fetch(
                'https://gh-proxy.com/https://raw.githubusercontent.com/jygldj/w/master/articles.json' + 
                Date.now()  + '.json',
                {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'token ' + token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        message: 'Add new article',
                        content: btoa(unescape(encodeURIComponent(
                            JSON.stringify({title,  content, category})
                        )))
                    })
                }
            );
            
            if(response.ok)  {
                alert('投稿成功！已存储到GitHub');
                location.href  = 'index.html'; 
            } else {
                alert('提交失败，请检查Token权限');
            }
        }
    </script>
</head>
<body>
    <!-- 顶部导航栏 -->
    <nav class="top-nav">
        <ul>
            <li><a href="index.html"> 返回首页</a></li>
        </ul>
    </nav>
 
    <div class="submit-container">
        <h1>作品投稿</h1>
        <form id="submission-form">
            <div class="form-group">
                <label for="category">作品类别:</label>
                <select id="category" name="category" required>
                    <option value="poetry">诗词</option>
                    <option value="prose">散文</option>
                    <option value="essays">杂记</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="title">题目:</label>
                <input type="text" id="title" name="title" required>
            </div>
            
            <div class="form-group">
                <label for="content">正文:</label>
                <textarea id="content" name="content" rows="15" required></textarea>
                <p>或上传文件: <input type="file" id="file-upload" accept=".txt,.doc,.docx"></p>
            </div>
            
            <div class="form-group">
                <label for="submit-date">提交时间:</label>
                <input type="datetime-local" id="submit-date" name="submit-date" required>
            </div>
            
            <button type="submit" class="submit-btn">提交作品</button>
    <form onsubmit="saveToGitHub(); return false;">
    <script src="script.js"></script> 
    </form>

</body>
</html>